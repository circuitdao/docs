---
id: price-oracle
title: Price Oracle
sidebar_position: 60
---

# Price Oracle

The protocol needs to know the market price of XCH in US Dollars to function properly. It does this by retrieving the XCH/USD price from an oracle.

By having access to the XCH/USD price, the protocol can value XCH collateral deposited in vaults. This is necessary in two situations:

* Borrows: If a new loan gets taken out, the resulting Liquidation Threshold must remain below the value of the vault's collateral.
* Liquidations: If the value of collateral in a vault drops below the Liquidation Threshold, the vault becomes eligible for liquidation.

The protocol also requires an oracle for the BYC/USD price in case of an Emergency Shutdown. This oracle price will only be retrieved once an ES has been successfully triggered.

## Oracle provider

The price oracle will initially be provided by CircuitDAO as there are currently no existing oracles on Chia. The plan is to switch to a third-party oracle once a reliable alternative becomes available, in which case the CircuitDAO oracle will be retained as a back-up in case the third-party oracle fails.

## Announcers

The oracle price is calculated as the median of prices provided by data providers, or **announcers**. Governance can whitelist up to 32 announcers that are eligible to publish price updates for the oracle.
Announcers can always update the price they publish in their respective announcer coins. The oracle price however, can only be updated subject to certain conditions, namely that

* the price has not been updated in more than 60 mins (assign parameter name), unless the price has changed by more than 1% (assign parameter name)
* there are at least m (assign parameter name) non-expired announcer prices available

Anyone can announce the latest oracle price by spending the oracle coin. The protocol itself doesn't directly use the oracle price, but copies it to Statutes, where it becomes active after **Oracle Price Delay** (OPD) has passed.

:::info

The CircuitDAO oracle supports [identical spend aggregation](https://docs.chia.net/faq/#what-is-identical-spend-aggregation), allowing it to be used by multiple protocols simultaneously.

:::

### Announcer fees

To reward announcers for their efforts, users that spend the oracle coin must make a payment to the announcers. This payment is a flat fee denominated in BYC, which is adjustable by governance (or simply let company pay announcers?).

In return for receiving the fee, announcers are expected to provide regular, timely and accurate price updates as the market price of XCH changes. Announcers that perform poorly should be removed and replaced by governance.

## Price calculation

The oracle price for XCH/USD is based on OKX prices, where the majority of XCH trading occurs. The price is calculated as the weighted average of all trades over the last X minutes.

For BYC/USD, the price will initially be fed in manually based on market price observations around the time of the Emergency Shutdown. Once the protocol has been operational for a while and there are liquid markets for BYC/USD either on-chain or off-chain, this process will be automated. As with the XCH/USD oracle, the long-term plan is to pass this to a third-party provider.


## Parameters

* **Oracle Price Delay (OPD)**
    * recorded in: Statutes
    * initial value: 1 hr
    * updatable: yes
    * votes requied: XYZ CRT
    * considerations: a longer delay gives users of the system more time to perform mitigating actions should the oracle price be incorrect. it also gives governance more time to disable price updates in such a scenario. a shorter delay leads to more timely liquidations and more accurate limits on borrowing, both of which reduce risk of the system becoming insufficiently or under-collateralised.
