---
id: price-oracle
title: Price Oracle
sidebar_position: 385
---

# Price Oracle

Price Oracle is a standard singleton.

### State and lineage

Fixed state:
* MUTATION_PROGRAM_HASH
* MOD_HASH
* ATOM_ANNOUNCER_PUZZLE_HASH

Immutable state:
* STATUTES_STRUCT

Mutable state:
* PRICES

The eve state of the Oracle has ```PRICES = (list (price . timestamp))```, which are both set by the protocol deployer. Price should be the current price, ideally derived from Announcers that are already running and derived with the same methodology that Oracle mutate operation uses. Timestamp should simply be the current timestamp.

PRICES is a list of price infos. Each price info is a two-element struct consisting of a price and timestamp of when the price info was added to the PRICES list.

Price infos are ordered in ascending chronological order, i.e. the price info with the lowest (ie oldest) timestamp comes first, the one with the highest (ie most recent) timestamp last.

The amount of the Oracle coin is always 1.

Since the Oracle is a standard singleton, it requires [standard lineage proofs](https://chialisp.com/singletons/#code).

## Operations

Puzzle that operations are performed on: [oracle.clsp](https://github.com/circuitdao/puzzles/blob/main/circuit_puzzles/oracle.clsp)

The Oracle does not have an owner.

Keeper operations:

* **Mutate**: updates the Oracle price - puzzle: [oracle_mutation.clsp](https://github.com/circuitdao/puzzles/blob/main/circuit_puzzles/programs/oracle_mutation.clsp)
* **Announce**: announces the Oracle Price - puzzle: [oracle.clsp](https://github.com/circuitdao/puzzles/blob/main/circuit_puzzles/oracle.clsp)

### Mutate

Mutate appends a new price info to PRICES. This is referred to as **updating the Oracle price** ('price' with a lower 'p'). The price info is generated by selecting at least M-of-N Announcers and announcing their prices. The mutate operation calculates a new price as the (lower) median of the selected Announcer prices. This new price together with the current timestamp forms the new price info.

Mutate also trims the PRICES list. A price info is called **matured** if its timestamp is < current time - STATUTES_PRICE_DELAY. The mutate operation retains only the most recent matured price info and non-matured price infos. It is possible for there to be no matured price info only for a brief period after protocol deployment. TODO: how do we prevent an increase in Statutes Price Delay to result in an un-maturing of price info and potentially no matured price info in PRICES?

### Announce

The announce operation announces the most recent matured price info from PRICES. The price of this price info is referred to as the **Oracle Price**.

The announce operation does not change the state of the Oracle. In particular, it does not trim the PRICES list.
